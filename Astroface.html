import React, { useState, useRef, useEffect } from 'react';
import { 
  Upload, Sparkles, ScanFace, Eye, Ear, 
  Smile, Activity, ArrowRight, Star, AlertCircle, 
  CheckCircle2, Loader2, X, RefreshCw, Camera
} from 'lucide-react';

// --- CSS Animations & Custom Styles ---
const customStyles = `
  @keyframes scan {
    0% { top: -5%; opacity: 0; }
    10% { opacity: 1; }
    90% { opacity: 1; }
    100% { top: 105%; opacity: 0; }
  }
  .animate-scan {
    animation: scan 2.5s cubic-bezier(0.4, 0, 0.2, 1) infinite;
  }
  
  @keyframes marquee {
    0% { transform: translateX(100%); }
    100% { transform: translateX(-100%); }
  }
  .animate-marquee {
    display: inline-block;
    white-space: nowrap;
    animation: marquee 20s linear infinite;
  }
  
  @keyframes float {
    0% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-15px) rotate(2deg); }
    100% { transform: translateY(0px) rotate(0deg); }
  }
  .animate-float {
    animation: float 5s ease-in-out infinite;
  }

  .glass-panel {
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
  }

  .text-gradient {
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
`;

export default function AstroFaceApp() {
  const [image, setImage] = useState(null);
  const [base64Image, setBase64Image] = useState(null);
  const [mimeType, setMimeType] = useState(null);
  const [isAnalyzing, setIsAnalyzing] = useState(false);
  const [result, setResult] = useState(null);
  const [error, setError] = useState(null);
  const [activeTab, setActiveTab] = useState('features');
  
  const [isCameraOpen, setIsCameraOpen] = useState(false);
  const [stream, setStream] = useState(null);
  
  const fileInputRef = useRef(null);
  const videoRef = useRef(null);
  const canvasRef = useRef(null);

  // System Provided API Key
  const apiKey = ""; 

  // --- Camera Functions ---
  const startCamera = async () => {
    try {
      const mediaStream = await navigator.mediaDevices.getUserMedia({ 
        video: { facingMode: 'user' } 
      });
      setStream(mediaStream);
      setIsCameraOpen(true);
      setError(null);
      // Wait for modal to render and ref to attach
      setTimeout(() => {
        if (videoRef.current) {
          videoRef.current.srcObject = mediaStream;
        }
      }, 100);
    } catch (err) {
      console.error("Camera error:", err);
      setError("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏ô‡∏≤‡∏¢ ‡∏•‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏î‡∏π‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö");
    }
  };

  const stopCamera = () => {
    if (stream) {
      stream.getTracks().forEach(track => track.stop());
      setStream(null);
    }
    setIsCameraOpen(false);
  };

  const capturePhoto = () => {
    if (videoRef.current && canvasRef.current) {
      const video = videoRef.current;
      const canvas = canvasRef.current;
      
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      const context = canvas.getContext('2d');
      
      // If facingMode is 'user', the video is usually mirrored. 
      // We flip it back for the capture so the image is saved correctly.
      context.translate(canvas.width, 0);
      context.scale(-1, 1);
      context.drawImage(video, 0, 0, canvas.width, canvas.height);

      const dataUrl = canvas.toDataURL('image/jpeg');
      setImage(dataUrl);
      const base64 = dataUrl.split(',')[1];
      setBase64Image(base64);
      setMimeType('image/jpeg');
      setResult(null);
      setError(null);
      
      stopCamera();
    }
  };

  useEffect(() => {
    return () => {
      // Cleanup camera on unmount
      if (stream) {
        stream.getTracks().forEach(track => track.stop());
      }
    };
  }, [stream]);

  const handleImageUpload = (e) => {
    const file = e.target.files[0];
    if (file) {
      if (!file.type.startsWith('image/')) {
        setError('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏ô‡∏≤‡∏¢');
        return;
      }
      
      const reader = new FileReader();
      reader.onloadend = () => {
        setImage(reader.result);
        const base64 = reader.result.split(',')[1];
        setBase64Image(base64);
        setMimeType(file.type);
        setResult(null);
        setError(null);
      };
      reader.readAsDataURL(file);
    }
  };

  const analyzeFace = async () => {
    if (!base64Image) return;

    setIsAnalyzing(true);
    setError(null);

    const prompt = `
      ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏õ‡∏£‡∏°‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏î‡πâ‡∏≤‡∏ô ‡πÇ‡∏´‡∏á‡∏ß‡πÄ‡∏Æ‡πâ‡∏á (‡∏à‡∏µ‡∏ô), ‡∏ô‡∏£‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå (‡πÑ‡∏ó‡∏¢) ‡πÅ‡∏•‡∏∞ ‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏¥‡∏Å‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå (‡∏≠‡∏¥‡∏ô‡πÄ‡∏î‡∏µ‡∏¢)
      ‡∏à‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏π‡∏õ‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏ô‡∏¥‡∏™‡∏±‡∏¢ ‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á ‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤ ‡πÇ‡∏î‡∏¢‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏ï‡∏≤‡∏°‡∏•‡∏±‡∏Ñ‡∏ô‡∏≤‡πÅ‡∏•‡∏∞‡∏ò‡∏≤‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö‡∏£‡∏π‡∏õ‡∏´‡∏ô‡πâ‡∏≤
      
      ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô JSON FORMAT ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ (‡∏ï‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î):
      {
        "ascendant": "‡∏•‡∏±‡∏Ñ‡∏ô‡∏≤/‡∏ò‡∏≤‡∏ï‡∏∏‡πÄ‡∏î‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÑ‡∏î‡πâ (‡πÄ‡∏ä‡πà‡∏ô ‡∏•‡∏±‡∏Ñ‡∏ô‡∏≤‡∏™‡∏¥‡∏á‡∏´‡πå ‡∏ò‡∏≤‡∏ï‡∏∏‡πÑ‡∏ü)",
        "summary": "‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÇ‡∏´‡∏á‡∏ß‡πÄ‡∏Æ‡πâ‡∏á‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡πÅ‡∏ö‡∏ö‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö‡πÅ‡∏•‡∏∞‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à",
        "features": {
          "faceShape": { "feature": "‡∏£‡∏π‡∏õ‡∏´‡∏ô‡πâ‡∏≤...", "reading": "‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢...", "origin": "‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå..." },
          "eyes": { "feature": "‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏ï‡∏≤...", "reading": "‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢...", "origin": "‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå..." },
          "nose": { "feature": "‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏à‡∏°‡∏π‡∏Å...", "reading": "‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢...", "origin": "‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå..." },
          "ears": { "feature": "‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏´‡∏π...", "reading": "‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢...", "origin": "‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå..." },
          "lips": { "feature": "‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏£‡∏¥‡∏°‡∏ù‡∏µ‡∏õ‡∏≤‡∏Å...", "reading": "‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢...", "origin": "‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå..." }
        },
        "personality": "‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏ô‡∏¥‡∏™‡∏±‡∏¢‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å",
        "strengths": ["‡∏Ç‡πâ‡∏≠‡∏î‡∏µ‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 1", "‡∏Ç‡πâ‡∏≠‡∏î‡∏µ‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 2", "‡∏Ç‡πâ‡∏≠‡∏î‡∏µ‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 3"],
        "weaknesses": ["‡∏Ç‡πâ‡∏≠‡∏î‡πâ‡∏≠‡∏¢‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 1", "‡∏Ç‡πâ‡∏≠‡∏î‡πâ‡∏≠‡∏¢‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 2", "‡∏Ç‡πâ‡∏≠‡∏î‡πâ‡∏≠‡∏¢‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 3"],
        "developmentGuide": "‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏î‡∏ß‡∏á"
      }
    `;

    try {
      let retryCount = 0;
      let success = false;
      let data = null;

      while (retryCount < 3 && !success) {
        try {
          const response = await fetch(
            `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
            {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                contents: [
                  {
                    role: "user",
                    parts: [
                      { text: prompt },
                      { inlineData: { mimeType: mimeType || "image/jpeg", data: base64Image } }
                    ]
                  }
                ],
                generationConfig: {
                  responseMimeType: "application/json"
                }
              })
            }
          );

          if (!response.ok) throw new Error('API Request Failed');
          
          const jsonResponse = await response.json();
          const textResponse = jsonResponse.candidates?.[0]?.content?.parts?.[0]?.text;
          
          if (textResponse) {
            data = JSON.parse(textResponse);
            success = true;
          } else {
            throw new Error('Invalid response format');
          }
        } catch (err) {
          retryCount++;
          if (retryCount >= 3) throw err;
          await new Promise(r => setTimeout(r, Math.pow(2, retryCount) * 1000)); // Exponential backoff
        }
      }

      setResult(data);
    } catch (err) {
      console.error(err);
      // Fallback Mock Data in case API is unavailable or rate limited in this environment
      setError("‡∏£‡∏∞‡∏ö‡∏ö AI ‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏±‡∏Å‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß ‡πÅ‡∏ï‡πà‡∏ú‡∏°‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ú‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏ô‡∏≤‡∏¢!");
      setResult({
        "ascendant": "‡∏•‡∏±‡∏Ñ‡∏ô‡∏≤‡∏û‡∏¥‡∏à‡∏¥‡∏Å ‡∏ò‡∏≤‡∏ï‡∏∏‡∏ô‡πâ‡∏≥‡∏ú‡∏™‡∏°‡πÑ‡∏ü (‡∏™‡πÄ‡∏ô‡πà‡∏´‡πå‡∏•‡∏∂‡∏Å‡∏•‡∏±‡∏ö)",
        "summary": "‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏´‡πà‡∏á‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏ö‡∏≤‡∏£‡∏°‡∏µ‡πÅ‡∏•‡∏∞‡πÑ‡∏´‡∏ß‡∏û‡∏£‡∏¥‡∏ö ‡∏ú‡∏™‡∏≤‡∏ô‡∏û‡∏•‡∏±‡∏á‡∏´‡∏¢‡∏¥‡∏ô‡∏´‡∏¢‡∏≤‡∏á‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏á‡∏ï‡∏±‡∏ß",
        "features": {
          "faceShape": { "feature": "‡∏£‡∏π‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏£‡∏á‡∏ú‡∏™‡∏° (‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡πÅ‡∏•‡∏∞‡∏°‡∏ô)", "reading": "‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î‡πÅ‡∏ï‡πà‡πÅ‡∏ù‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏ô‡∏µ‡∏õ‡∏£‡∏∞‡∏ô‡∏≠‡∏° ‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏±‡∏Å‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ä‡∏±‡πâ‡∏ô‡∏¢‡∏≠‡∏î", "origin": "‡∏ô‡∏£‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå (‡πÑ‡∏ó‡∏¢)" },
          "eyes": { "feature": "‡∏ï‡∏≤‡∏´‡∏á‡∏™‡πå ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏¢‡πÅ‡∏ß‡∏ß‡∏ß‡∏≤‡∏ß", "reading": "‡∏°‡∏µ‡πÄ‡∏™‡∏ô‡πà‡∏´‡πå‡∏î‡∏∂‡∏á‡∏î‡∏π‡∏î‡πÉ‡∏à ‡∏â‡∏•‡∏≤‡∏î‡∏´‡∏•‡∏±‡∏Å‡πÅ‡∏´‡∏•‡∏° ‡∏°‡∏≠‡∏á‡∏Ñ‡∏ô‡∏ó‡∏∞‡∏•‡∏∏‡∏õ‡∏£‡∏∏‡πÇ‡∏õ‡∏£‡πà‡∏á", "origin": "‡πÇ‡∏´‡∏á‡∏ß‡πÄ‡∏Æ‡πâ‡∏á (‡∏à‡∏µ‡∏ô)" },
          "nose": { "feature": "‡∏™‡∏±‡∏ô‡∏à‡∏°‡∏π‡∏Å‡∏ï‡∏£‡∏á ‡∏õ‡∏•‡∏≤‡∏¢‡∏≠‡∏¥‡πà‡∏°‡πÄ‡∏ï‡πá‡∏°", "reading": "‡∏´‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡πà‡∏á ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏¢‡∏π‡πà ‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏µ‡∏î‡πâ‡∏ß‡∏¢‡∏•‡∏≥‡πÅ‡∏Ç‡πâ‡∏á‡∏ï‡∏ô‡πÄ‡∏≠‡∏á", "origin": "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏¥‡∏Å‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå (‡∏≠‡∏¥‡∏ô‡πÄ‡∏î‡∏µ‡∏¢)" },
          "ears": { "feature": "‡∏ï‡∏¥‡πà‡∏á‡∏´‡∏π‡∏´‡∏ô‡∏≤ ‡∏Ç‡∏≠‡∏ö‡∏´‡∏π‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô", "reading": "‡∏≠‡∏≤‡∏¢‡∏∏‡∏¢‡∏∑‡∏ô ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á ‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà‡∏≠‡∏∏‡∏õ‡∏ñ‡∏±‡∏°‡∏†‡πå‡∏Ñ‡πâ‡∏≥‡∏ä‡∏π", "origin": "‡πÇ‡∏´‡∏á‡∏ß‡πÄ‡∏Æ‡πâ‡∏á (‡∏à‡∏µ‡∏ô)" },
          "lips": { "feature": "‡∏£‡∏¥‡∏°‡∏ù‡∏µ‡∏õ‡∏≤‡∏Å‡∏Å‡∏£‡∏∞‡∏à‡∏±‡∏ö ‡∏°‡∏∏‡∏°‡∏õ‡∏≤‡∏Å‡∏¢‡∏Å", "reading": "‡πÄ‡∏à‡∏£‡∏à‡∏≤‡∏û‡∏≤‡∏ó‡∏µ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏•‡∏¥‡∏® ‡∏Ñ‡∏≥‡∏û‡∏π‡∏î‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå ‡πÇ‡∏ô‡πâ‡∏°‡∏ô‡πâ‡∏≤‡∏ß‡πÉ‡∏à‡∏Ñ‡∏ô‡πÄ‡∏Å‡πà‡∏á", "origin": "‡∏ô‡∏£‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå (‡πÑ‡∏ó‡∏¢)" }
        },
        "personality": "‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏™‡∏π‡∏á ‡∏ó‡∏∞‡πÄ‡∏¢‡∏≠‡∏ó‡∏∞‡∏¢‡∏≤‡∏ô ‡πÅ‡∏ï‡πà‡∏ã‡πà‡∏≠‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡πà‡∏≠‡∏ô‡πÇ‡∏¢‡∏ô‡πÑ‡∏ß‡πâ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ‡∏ä‡∏≠‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏™‡∏¥‡πà‡∏á‡πÉ‡∏´‡∏°‡πà‡πÜ ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡∏ó‡∏µ‡πà‡∏´‡∏Å‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ ‡∏°‡∏±‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏∑‡πà‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏°‡∏≠",
        "strengths": ["‡πÑ‡∏´‡∏ß‡∏û‡∏£‡∏¥‡∏ö‡∏î‡∏µ ‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Å‡πà‡∏á", "‡∏°‡∏µ‡πÄ‡∏™‡∏ô‡πà‡∏´‡πå‡∏ó‡∏≤‡∏á‡∏Ñ‡∏≥‡∏û‡∏π‡∏î‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡∏ï‡∏±‡∏ß", "‡∏°‡∏∏‡πà‡∏á‡∏°‡∏±‡πà‡∏ô ‡πÑ‡∏°‡πà‡∏¢‡∏≠‡∏°‡πÅ‡∏û‡πâ‡∏≠‡∏∞‡πÑ‡∏£‡∏á‡πà‡∏≤‡∏¢‡πÜ"],
        "weaknesses": ["‡∏ö‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏î‡∏∑‡πâ‡∏≠‡∏£‡∏±‡πâ‡∏ô ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡πÑ‡∏õ", "‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÄ‡∏Å‡πà‡∏á‡∏à‡∏ô‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î‡∏™‡∏∞‡∏™‡∏°", "‡∏Ç‡∏µ‡πâ‡πÄ‡∏ö‡∏∑‡πà‡∏≠ ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤"],
        "developmentGuide": "‡∏Ñ‡∏ß‡∏£‡∏ù‡∏∂‡∏Å‡∏™‡∏°‡∏≤‡∏ò‡∏¥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô‡∏£‡∏∏‡πà‡∏°‡πÉ‡∏ô‡πÉ‡∏à ‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏î‡∏ß‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏ß‡∏°‡πÉ‡∏™‡πà‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏µ‡πÇ‡∏ó‡∏ô‡πÄ‡∏¢‡πá‡∏ô (‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô, ‡∏°‡πà‡∏ß‡∏á) ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏à‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏´‡πâ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô ‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏û‡∏•‡∏±‡∏á‡∏ö‡∏≤‡∏£‡∏°‡∏µ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÅ‡∏ö‡∏ö‡πÑ‡∏£‡πâ‡∏ó‡∏µ‡πà‡∏ï‡∏¥"
      });
    } finally {
      setIsAnalyzing(false);
    }
  };

  const resetApp = () => {
    setImage(null);
    setBase64Image(null);
    setResult(null);
    setError(null);
  };

  return (
    <div className="min-h-screen bg-[#0a0514] text-white font-sans overflow-hidden relative selection:bg-purple-500/30">
      <style dangerouslySetInnerHTML={{ __html: customStyles }} />
      
      {/* Mystical Background Elements */}
      <div className="fixed inset-0 z-0 overflow-hidden pointer-events-none">
        <div className="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-purple-600/20 rounded-full blur-[120px] mix-blend-screen"></div>
        <div className="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-indigo-600/20 rounded-full blur-[120px] mix-blend-screen"></div>
        <div className="absolute top-[40%] left-[50%] transform -translate-x-1/2 -translate-y-1/2 w-[60%] h-[60%] bg-fuchsia-600/10 rounded-full blur-[150px] mix-blend-screen"></div>
      </div>

      {/* Marquee Info Bar */}
      <div className="relative z-10 bg-gradient-to-r from-purple-900/80 via-indigo-900/80 to-purple-900/80 border-b border-white/10 overflow-hidden py-2 backdrop-blur-sm">
        <div className="flex w-full overflow-hidden">
          <div className="animate-marquee flex gap-12 items-center text-sm font-medium tracking-wider text-purple-200">
            <span>‚ú® ‡∏ú‡∏™‡∏≤‡∏ô‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÇ‡∏´‡∏á‡∏ß‡πÄ‡∏Æ‡πâ‡∏á (‡∏à‡∏µ‡∏ô) ‚Ä¢ ‡∏ô‡∏£‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå (‡πÑ‡∏ó‡∏¢) ‚Ä¢ ‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏¥‡∏Å‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå (‡∏≠‡∏¥‡∏ô‡πÄ‡∏î‡∏µ‡∏¢)</span>
            <span>üîÆ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏à‡∏≤‡∏∞‡∏•‡∏∂‡∏Å‡∏î‡πâ‡∏ß‡∏¢ AI ‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</span>
            <span>üåü ‡∏Ñ‡πâ‡∏ô‡∏û‡∏ö‡∏®‡∏±‡∏Å‡∏¢‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡∏´‡∏ô‡πâ‡∏≤ ‡∏ï‡∏≤ ‡∏à‡∏°‡∏π‡∏Å ‡∏´‡∏π ‡πÅ‡∏•‡∏∞‡∏£‡∏¥‡∏°‡∏ù‡∏µ‡∏õ‡∏≤‡∏Å</span>
            <span>‚ú® ‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô ‡πÅ‡∏Å‡πâ‡∏à‡∏∏‡∏î‡∏î‡πâ‡∏≠‡∏¢ ‡∏û‡∏•‡∏¥‡∏Å‡∏ä‡∏∞‡∏ï‡∏≤‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå</span>
          </div>
        </div>
      </div>

      {/* Camera Modal Overlay */}
      {isCameraOpen && (
        <div className="fixed inset-0 z-50 bg-black/90 backdrop-blur-md flex flex-col items-center justify-center p-4 animate-in fade-in duration-300">
          <div className="w-full max-w-md bg-white/5 border border-white/10 p-6 rounded-3xl flex flex-col items-center shadow-2xl shadow-purple-900/50">
            <h3 className="text-xl font-bold text-white mb-4 flex items-center gap-2">
              <Camera className="w-6 h-6 text-fuchsia-400" /> ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏£‡∏á
            </h3>
            <div className="w-full aspect-[3/4] bg-black rounded-2xl overflow-hidden relative mb-6 border-2 border-fuchsia-500/30">
              <video
                ref={videoRef}
                autoPlay
                playsInline
                className="w-full h-full object-cover transform -scale-x-100" 
              />
              {/* Reference guide overlay */}
              <div className="absolute inset-0 border-[3px] border-dashed border-white/20 rounded-[40%] m-8 pointer-events-none"></div>
              <canvas ref={canvasRef} className="hidden" />
            </div>
            <div className="flex gap-4 w-full">
              <button
                onClick={stopCamera}
                className="flex-1 py-4 rounded-2xl bg-white/10 hover:bg-white/20 text-white font-semibold transition-all"
              >
                ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
              </button>
              <button
                onClick={capturePhoto}
                className="flex-[2] py-4 rounded-2xl bg-gradient-to-r from-fuchsia-600 to-indigo-600 hover:from-fuchsia-500 hover:to-indigo-500 text-white font-bold shadow-lg shadow-purple-500/30 transition-all flex items-center justify-center gap-2"
              >
                <Camera className="w-6 h-6" /> ‡πÅ‡∏ä‡∏∞! ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ
              </button>
            </div>
          </div>
        </div>
      )}

      <div className="relative z-10 max-w-5xl mx-auto px-4 py-8 md:py-12 flex flex-col items-center">
        
        {/* Header */}
        <div className="text-center mb-10 animate-float">
          <div className="inline-flex items-center justify-center p-3 bg-white/5 rounded-2xl border border-white/10 mb-4 backdrop-blur-md">
            <ScanFace className="w-8 h-8 text-fuchsia-400 mr-3" />
            <h1 className="text-3xl md:text-5xl font-extrabold tracking-tight bg-gradient-to-r from-fuchsia-400 via-purple-400 to-indigo-400 text-gradient">
              AstroFace
            </h1>
          </div>
          <p className="text-gray-300 max-w-xl mx-auto text-lg">
            ‡πÄ‡∏à‡πâ‡∏≤‡∏ô‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏£‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡∏ú‡∏°‡∏ú‡∏™‡∏≤‡∏ô 3 ‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏´‡πà‡∏á‡∏î‡∏ß‡∏á‡∏î‡∏≤‡∏ß ‡∏™‡πÅ‡∏Å‡∏ô‡πÇ‡∏´‡∏á‡∏ß‡πÄ‡∏Æ‡πâ‡∏á‡πÅ‡∏ö‡∏ö‡πÄ‡∏à‡∏≤‡∏∞‡∏•‡∏∂‡∏Å‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö
          </p>
        </div>

        {error && (
          <div className="w-full max-w-2xl bg-red-500/10 border border-red-500/50 rounded-xl p-4 mb-6 flex items-start gap-3 backdrop-blur-md">
            <AlertCircle className="w-6 h-6 text-red-400 flex-shrink-0 mt-0.5" />
            <p className="text-red-200">{error}</p>
          </div>
        )}

        {/* Main Content Area */}
        <div className="w-full max-w-4xl grid grid-cols-1 md:grid-cols-12 gap-8">
          
          {/* Left Column: Image Area */}
          <div className={`col-span-1 ${result ? 'md:col-span-5' : 'md:col-span-12 max-w-md mx-auto w-full'} transition-all duration-500`}>
            <div className="glass-panel rounded-3xl p-2 relative group overflow-hidden">
              {!image ? (
                // Upload & Camera State
                <div className="flex flex-col gap-3 h-full p-2">
                  <div 
                    className="flex-1 border-2 border-dashed border-purple-500/30 rounded-2xl aspect-[4/3] flex flex-col items-center justify-center p-6 text-center cursor-pointer hover:bg-purple-500/5 hover:border-purple-400 transition-all duration-300"
                    onClick={() => fileInputRef.current?.click()}
                  >
                    <div className="w-16 h-16 bg-purple-500/20 rounded-full flex items-center justify-center mb-3 group-hover:scale-110 transition-transform">
                      <Upload className="w-8 h-8 text-purple-300" />
                    </div>
                    <h3 className="text-lg font-bold text-white mb-1">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏£‡∏á</h3>
                    <p className="text-xs text-gray-400">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö JPG, PNG</p>
                    <input 
                      type="file" 
                      accept="image/*" 
                      className="hidden" 
                      ref={fileInputRef}
                      onChange={handleImageUpload}
                    />
                  </div>
                  
                  <div className="flex items-center gap-4 w-full px-2 py-1">
                    <div className="flex-1 h-px bg-white/10"></div>
                    <span className="text-xs font-medium text-gray-400">‡∏´‡∏£‡∏∑‡∏≠</span>
                    <div className="flex-1 h-px bg-white/10"></div>
                  </div>

                  <button 
                    onClick={startCamera}
                    className="w-full bg-gradient-to-r from-purple-600/20 to-indigo-600/20 hover:from-purple-600/40 hover:to-indigo-600/40 border border-purple-500/30 text-purple-100 font-bold py-4 px-6 rounded-2xl transition-all flex items-center justify-center gap-3 group/btn"
                  >
                    <div className="bg-purple-500/20 p-2 rounded-full group-hover/btn:scale-110 transition-transform">
                      <Camera className="w-6 h-6 text-fuchsia-400" />
                    </div>
                    ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏•‡πâ‡∏≠‡∏á
                  </button>
                </div>
              ) : (
                // Image Preview State
                <div className="relative rounded-2xl overflow-hidden aspect-[3/4] bg-black">
                  <img 
                    src={image} 
                    alt="Face to analyze" 
                    className={`w-full h-full object-cover transition-all duration-700 ${isAnalyzing ? 'scale-105 blur-sm brightness-50' : ''}`}
                  />
                  
                  {/* Scanning Animation */}
                  {isAnalyzing && (
                    <>
                      <div className="absolute inset-0 bg-gradient-to-b from-transparent via-fuchsia-500/20 to-transparent animate-scan w-full h-[20%] border-y border-fuchsia-400/50 blur-[2px] z-20" />
                      <div className="absolute inset-0 flex flex-col items-center justify-center z-30">
                        <Loader2 className="w-12 h-12 text-fuchsia-400 animate-spin mb-4" />
                        <p className="text-fuchsia-300 font-medium text-lg tracking-widest animate-pulse drop-shadow-md">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ú‡∏™‡∏≤‡∏ô 3 ‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...</p>
                      </div>
                      
                      {/* Mystical overlay grids */}
                      <div className="absolute inset-0 z-10 opacity-30" style={{ backgroundImage: 'linear-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px)', backgroundSize: '20px 20px' }}></div>
                    </>
                  )}
                  
                  {/* Overlay for Action */}
                  {!isAnalyzing && !result && (
                     <div className="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center gap-4">
                        <button 
                          onClick={analyzeFace}
                          className="bg-gradient-to-r from-fuchsia-600 to-indigo-600 hover:from-fuchsia-500 hover:to-indigo-500 text-white font-bold py-3 px-6 rounded-full shadow-lg shadow-purple-500/30 transform hover:scale-105 transition-all flex items-center gap-2"
                        >
                          <Sparkles className="w-5 h-5" />
                          ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡πÇ‡∏´‡∏á‡∏ß‡πÄ‡∏Æ‡πâ‡∏á
                        </button>
                        <button 
                          onClick={resetApp}
                          className="text-gray-300 hover:text-white text-sm underline flex items-center gap-1"
                        >
                          <RefreshCw className="w-4 h-4" /> ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ
                        </button>
                     </div>
                  )}
                  
                  {result && (
                    <button 
                      onClick={resetApp}
                      className="absolute top-4 right-4 bg-black/50 hover:bg-black/80 p-2 rounded-full backdrop-blur-md transition-colors"
                    >
                      <X className="w-5 h-5 text-white" />
                    </button>
                  )}
                </div>
              )}
            </div>
            
            {!result && image && !isAnalyzing && (
               <div className="mt-6 text-center animate-pulse">
                  <p className="text-purple-300">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏£‡∏π‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö!</p>
               </div>
            )}
          </div>

          {/* Right Column: Results Area */}
          {result && (
            <div className="col-span-1 md:col-span-7 flex flex-col gap-6 animate-in fade-in slide-in-from-bottom-8 duration-700">
              
              {/* Header Result Card */}
              <div className="glass-panel rounded-3xl p-6 relative overflow-hidden border-t border-t-fuchsia-400/30">
                <div className="absolute top-0 right-0 p-4 opacity-20">
                  <Star className="w-24 h-24 text-fuchsia-400" />
                </div>
                <div className="relative z-10">
                  <div className="inline-block px-3 py-1 bg-fuchsia-500/20 text-fuchsia-300 rounded-full text-sm font-semibold mb-3 border border-fuchsia-500/30">
                    {result.ascendant}
                  </div>
                  <h2 className="text-2xl md:text-3xl font-bold text-white mb-2 leading-snug">
                    {result.summary}
                  </h2>
                </div>
              </div>

              {/* Tabs */}
              <div className="flex bg-white/5 p-1 rounded-2xl backdrop-blur-sm">
                <button 
                  onClick={() => setActiveTab('features')}
                  className={`flex-1 py-3 text-sm font-semibold rounded-xl transition-all ${activeTab === 'features' ? 'bg-gradient-to-r from-purple-600 to-indigo-600 text-white shadow-lg' : 'text-gray-400 hover:text-white hover:bg-white/5'}`}
                >
                  ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏ß‡∏±‡∏¢‡∏ß‡∏∞
                </button>
                <button 
                  onClick={() => setActiveTab('traits')}
                  className={`flex-1 py-3 text-sm font-semibold rounded-xl transition-all ${activeTab === 'traits' ? 'bg-gradient-to-r from-purple-600 to-indigo-600 text-white shadow-lg' : 'text-gray-400 hover:text-white hover:bg-white/5'}`}
                >
                  ‡∏ô‡∏¥‡∏™‡∏±‡∏¢ & ‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô
                </button>
                <button 
                  onClick={() => setActiveTab('guide')}
                  className={`flex-1 py-3 text-sm font-semibold rounded-xl transition-all ${activeTab === 'guide' ? 'bg-gradient-to-r from-purple-600 to-indigo-600 text-white shadow-lg' : 'text-gray-400 hover:text-white hover:bg-white/5'}`}
                >
                  ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤
                </button>
              </div>

              {/* Tab Content: Features */}
              {activeTab === 'features' && (
                <div className="grid grid-cols-1 gap-4 animate-in fade-in duration-500">
                  <FeatureCard 
                    icon={<ScanFace className="w-5 h-5 text-cyan-400" />} 
                    title="‡∏£‡∏π‡∏õ‡∏´‡∏ô‡πâ‡∏≤ (Face Shape)" 
                    data={result.features.faceShape}
                    color="cyan"
                  />
                  <FeatureCard 
                    icon={<Eye className="w-5 h-5 text-indigo-400" />} 
                    title="‡∏î‡∏ß‡∏á‡∏ï‡∏≤ (Eyes)" 
                    data={result.features.eyes}
                    color="indigo"
                  />
                  <FeatureCard 
                    icon={<Activity className="w-5 h-5 text-amber-400" />} 
                    title="‡∏à‡∏°‡∏π‡∏Å (Nose)" 
                    data={result.features.nose}
                    color="amber"
                  />
                  <FeatureCard 
                    icon={<Ear className="w-5 h-5 text-emerald-400" />} 
                    title="‡πÉ‡∏ö‡∏´‡∏π (Ears)" 
                    data={result.features.ears}
                    color="emerald"
                  />
                  <FeatureCard 
                    icon={<Smile className="w-5 h-5 text-rose-400" />} 
                    title="‡∏£‡∏¥‡∏°‡∏ù‡∏µ‡∏õ‡∏≤‡∏Å (Lips)" 
                    data={result.features.lips}
                    color="rose"
                  />
                </div>
              )}

              {/* Tab Content: Traits */}
              {activeTab === 'traits' && (
                <div className="flex flex-col gap-4 animate-in fade-in duration-500">
                  <div className="glass-panel p-6 rounded-2xl">
                    <h3 className="text-xl font-bold text-white mb-3 flex items-center gap-2">
                      <Sparkles className="w-5 h-5 text-purple-400" /> ‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πâ‡∏à‡∏£‡∏¥‡∏á
                    </h3>
                    <p className="text-gray-300 leading-relaxed text-sm md:text-base">
                      {result.personality}
                    </p>
                  </div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="glass-panel p-6 rounded-2xl border-t border-t-emerald-500/30">
                      <h3 className="text-lg font-bold text-emerald-300 mb-4 flex items-center gap-2">
                        <CheckCircle2 className="w-5 h-5" /> ‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô (Strengths)
                      </h3>
                      <ul className="space-y-3">
                        {result.strengths.map((item, idx) => (
                          <li key={idx} className="flex items-start gap-2 text-sm text-gray-300">
                            <span className="text-emerald-400 mt-1">‚Ä¢</span>
                            <span>{item}</span>
                          </li>
                        ))}
                      </ul>
                    </div>
                    
                    <div className="glass-panel p-6 rounded-2xl border-t border-t-rose-500/30">
                      <h3 className="text-lg font-bold text-rose-300 mb-4 flex items-center gap-2">
                        <AlertCircle className="w-5 h-5" /> ‡∏à‡∏∏‡∏î‡∏î‡πâ‡∏≠‡∏¢ (Weaknesses)
                      </h3>
                      <ul className="space-y-3">
                        {result.weaknesses.map((item, idx) => (
                          <li key={idx} className="flex items-start gap-2 text-sm text-gray-300">
                            <span className="text-rose-400 mt-1">‚Ä¢</span>
                            <span>{item}</span>
                          </li>
                        ))}
                      </ul>
                    </div>
                  </div>
                </div>
              )}

              {/* Tab Content: Guide */}
              {activeTab === 'guide' && (
                <div className="glass-panel p-6 rounded-2xl border-l-4 border-l-fuchsia-500 animate-in fade-in duration-500 relative overflow-hidden">
                  <div className="absolute top-0 right-0 w-32 h-32 bg-fuchsia-500/10 rounded-full blur-2xl"></div>
                  <h3 className="text-xl font-bold text-white mb-4 flex items-center gap-2 relative z-10">
                    <Star className="w-6 h-6 text-fuchsia-400 fill-fuchsia-400" /> ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤
                  </h3>
                  <div className="bg-white/5 rounded-xl p-5 relative z-10 border border-white/10">
                    <p className="text-gray-200 leading-relaxed text-lg">
                      {result.developmentGuide}
                    </p>
                  </div>
                  
                  <div className="mt-6 flex justify-end relative z-10">
                    <button 
                      onClick={() => {
                        alert('‡πÄ‡∏à‡πâ‡∏≤‡∏ô‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÅ‡∏ä‡∏£‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÉ‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡πà‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö üöÄ');
                      }}
                      className="text-sm px-4 py-2 bg-purple-600/30 hover:bg-purple-600/50 text-purple-200 rounded-lg transition-colors flex items-center gap-2"
                    >
                      ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢ <ArrowRight className="w-4 h-4" />
                    </button>
                  </div>
                </div>
              )}

            </div>
          )}
        </div>
      </div>
    </div>
  );
}

// Sub-component for displaying each facial feature reading
function FeatureCard({ icon, title, data, color }) {
  if (!data) return null;
  
  const colorMap = {
    cyan: 'bg-cyan-500/10 border-cyan-500/20 text-cyan-300',
    indigo: 'bg-indigo-500/10 border-indigo-500/20 text-indigo-300',
    amber: 'bg-amber-500/10 border-amber-500/20 text-amber-300',
    emerald: 'bg-emerald-500/10 border-emerald-500/20 text-emerald-300',
    rose: 'bg-rose-500/10 border-rose-500/20 text-rose-300',
  };
  
  return (
    <div className="glass-panel p-4 rounded-2xl flex flex-col md:flex-row gap-4 items-start md:items-center hover:bg-white/10 transition-colors duration-300">
      <div className={`p-3 rounded-xl flex-shrink-0 border ${colorMap[color]}`}>
        {icon}
      </div>
      <div className="flex-1">
        <div className="flex items-center gap-2 mb-1">
          <h4 className="font-bold text-white">{title}</h4>
          <span className="text-[10px] uppercase px-2 py-0.5 rounded-full bg-white/10 text-gray-300 tracking-wider">
            {data.origin}
          </span>
        </div>
        <p className="text-sm font-medium text-purple-200 mb-1">‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞: {data.feature}</p>
        <p className="text-sm text-gray-400">{data.reading}</p>
      </div>
    </div>
  );
}