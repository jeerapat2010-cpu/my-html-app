<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบข้อมูลการลักลอบส่งออกช่อดอกกัญชา - สมุทรปราการ</title>
    
    <!-- Fonts: Sarabun for Thai, Inter for Numbers -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Sarabun', 'Inter', 'sans-serif'],
                        mono: ['Inter', 'monospace'],
                    },
                    colors: {
                        brand: {
                            50: '#eef2ff', 100: '#e0e7ff', 500: '#6366f1', 600: '#4f46e5', 700: '#4338ca', 800: '#3730a3', 900: '#312e81',
                        },
                        slate: {
                            50: '#f8fafc', 100: '#f1f5f9', 200: '#e2e8f0', 300: '#cbd5e1', 500: '#64748b', 700: '#334151', 800: '#1e293b', 900: '#0f172a',
                        },
                        accent: {
                            orange: '#f97316', teal: '#14b8a6', rose: '#f43f5e', violet: '#8b5cf6', amber: '#f59e0b'
                        }
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                        'card': '0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)',
                        'glow': '0 0 15px rgba(99, 102, 241, 0.3)'
                    }
                }
            }
        }
    </script>
    
    <!-- React & Libraries -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    <script src="https://unpkg.com/react-is@18.2.0/umd/react-is.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.12.7/Recharts.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        body { background-color: #f8fafc; color: #1e293b; }
        .leaflet-container { width: 100%; height: 100%; border-radius: 0.75rem; z-index: 1; border: 1px solid #e2e8f0; }
        .leaflet-popup-content-wrapper { border-radius: 0.5rem; font-family: 'Sarabun', sans-serif; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Menu Buttons */
        .nav-btn-active { background-color: white; color: #4338ca; border: 1px solid #c7d2fe; box-shadow: 0 2px 4px rgba(0,0,0,0.05); font-weight: 700; }
        .nav-btn-inactive { color: #c7d2fe; font-weight: 500; }
        .nav-btn-inactive:hover { background-color: rgba(255,255,255,0.1); color: white; }
        
        .header-gradient { background: linear-gradient(135deg, #1e1b4b 0%, #312e81 60%, #4338ca 100%); }
        .custom-table th { background-color: #f8fafc; color: #475569; font-weight: 700; text-transform: uppercase; font-size: 0.8rem; padding: 12px 16px; border-bottom: 2px solid #e2e8f0; }
        .custom-table td { padding: 12px 16px; border-bottom: 1px solid #f1f5f9; color: #334155; font-size: 0.9rem; vertical-align: top; }
        .custom-table tr:hover { background-color: #f1f5f9; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        const { jsPDF } = window.jspdf;

        // --- Mock Data ---
        const MOCK_SHIPMENTS = [
            // Oct
            { hwb: '10001', origin: 'TH', dest: 'GB', weight: 4.2, desc: 'HERBAL TEA', shipperCity: 'BANGKOK', date: '2025-10-15', shipper: 'THAI HERB LTD', receiver: 'UK IMPORTS', shipperAddr: 'Bangkok HQ', receiverAddr: 'London Center', originLat: 13.7500, originLng: 100.5000, destLat: 51.5074, destLng: -0.1278 },
            { hwb: '10002', origin: 'TH', dest: 'DE', weight: 2.1, desc: 'DRIED FLOWERS', shipperCity: 'CHIANG MAI', date: '2025-10-22', shipper: 'NORTHERN FLORA', receiver: 'GERMAN TRADERS', shipperAddr: 'Chiang Mai', receiverAddr: 'Berlin', originLat: 18.7900, originLng: 98.9600, destLat: 52.5200, destLng: 13.4050 },
            { hwb: '10003', origin: 'TH', dest: 'GB', weight: 3.5, desc: 'SNACKS', shipperCity: 'BANGKOK', date: '2025-10-28', shipper: 'BKK EXPORT', receiver: 'LONDON SNACKS', shipperAddr: 'Bangkok', receiverAddr: 'London', originLat: 13.7500, originLng: 100.5100, destLat: 51.5074, destLng: -0.1278 },
            // Nov
            { hwb: '20001', origin: 'TH', dest: 'JP', weight: 1.8, desc: 'INCENSE', shipperCity: 'CHONBURI', date: '2025-11-05', shipper: 'EASTERN SCENTS', receiver: 'JAPAN GOODS', shipperAddr: 'Pattaya', receiverAddr: 'Tokyo', originLat: 12.9200, originLng: 100.8800, destLat: 35.6762, destLng: 139.6503 },
            { hwb: '20002', origin: 'TH', dest: 'GB', weight: 5.5, desc: 'SNACKS', shipperCity: 'SAMUTPRAKARN', date: '2025-11-18', shipper: 'SNACK THAI', receiver: 'UK SNACKS', shipperAddr: 'Bang Phli', receiverAddr: 'Manchester', originLat: 13.6000, originLng: 100.7000, destLat: 53.4808, destLng: -2.2426 },
            { hwb: '20003', origin: 'TH', dest: 'AU', weight: 3.0, desc: 'TEA', shipperCity: 'PHUKET', date: '2025-11-25', shipper: 'ISLAND TEA', receiver: 'AUSSIE IMPORTS', shipperAddr: 'Phuket', receiverAddr: 'Sydney', originLat: 7.8900, originLng: 98.2900, destLat: -33.8688, destLng: 151.2093 },
            { hwb: '20004', origin: 'TH', dest: 'GB', weight: 2.2, desc: 'TEA', shipperCity: 'BANGKOK', date: '2025-11-30', shipper: 'SIAM TRADING', receiver: 'GB TEAS', shipperAddr: 'Bangkok', receiverAddr: 'London', originLat: 13.7500, originLng: 100.5200, destLat: 51.5074, destLng: -0.1278 },
            // Dec
            { hwb: '7276951614', origin: 'TH', dest: 'GB', weight: 3.72, desc: 'RED TEA POWDER', shipperCity: 'BANGKOK', shipper: 'BO JUN XIAO', receiver: 'ATTN:XING YU', date: '2025-12-11', shipperAddr: '14 Naradhiwas Rd, Sathon', receiverAddr: 'Sheffield', originLat: 13.7200, originLng: 100.5200, destLat: 53.3811, destLng: -1.4701 },
            { hwb: '8147438401', origin: 'TH', dest: 'GB', weight: 10.24, desc: 'COOKIES SNACK', shipperCity: 'SAMUTPRAKARN', shipper: 'BUNYAKAN BUMPING', receiver: 'MR.TUAN HIEN', date: '2025-12-12', shipperAddr: '125/1 Moo 5', receiverAddr: 'Glasgow', originLat: 13.6100, originLng: 100.7500, destLat: 55.8642, destLng: -4.2518 },
            { hwb: '1406595455', origin: 'TH', dest: 'BE', weight: 6.64, desc: 'HAIR TREATMENT', shipperCity: 'SURAT THANI', shipper: 'LUTFEE DOLOH', receiver: 'INES GHENNAM', date: '2025-12-29', shipperAddr: 'Koh Samui', receiverAddr: 'Liege', originLat: 9.5300, originLng: 99.9400, destLat: 50.6326, destLng: 5.5797 },
            { hwb: '8986797886', origin: 'TH', dest: 'MU', weight: 5.92, desc: 'CHILDREN TOYS', shipperCity: 'PATHUMTHANI', shipper: 'MISS SUNEE PHINHOM', receiver: 'MARIE LNGRIDHENRY', date: '2025-12-29', shipperAddr: 'Pathumthani', receiverAddr: 'Curepipe', originLat: 14.0600, originLng: 100.6200, destLat: -20.3180, destLng: 57.5255 },
            { hwb: '2507888213', origin: 'TH', dest: 'BE', weight: 3.34, desc: 'Completed Forms', shipperCity: 'SURAT THANI', shipper: 'ALEXIS LEBRAS', receiver: 'EYOUB MELLOULI', date: '2025-12-30', shipperAddr: 'Koh Samui', receiverAddr: 'Liege', originLat: 9.5350, originLng: 99.9450, destLat: 50.6330, destLng: 5.5800 },
            { hwb: '1659827562', origin: 'TH', dest: 'JP', weight: 2.6, desc: 'SKIN CREAM', shipperCity: 'BANGKOK', shipper: 'MAKOTO TAMAMURA', receiver: 'CAO KAIYI', date: '2025-12-29', shipperAddr: 'Ekamai', receiverAddr: 'Osaka', originLat: 13.7300, originLng: 100.5800, destLat: 34.6937, destLng: 135.5023 },
            { hwb: '2321374403', origin: 'TH', dest: 'JP', weight: 3.1, desc: 'SKIN CREAM', shipperCity: 'BANGKOK', shipper: 'MAKOTO TAMAMURA', receiver: 'CAO KAIYI', date: '2025-12-30', shipperAddr: 'Ekamai', receiverAddr: 'Osaka', originLat: 13.7300, originLng: 100.5800, destLat: 34.6937, destLng: 135.5023 },
            { hwb: '5566778899', origin: 'TH', dest: 'GB', weight: 8.0, desc: 'TEA', shipperCity: 'BANGKOK', shipper: 'SIAM TEA', receiver: 'TEA IMPORTS LTD', date: '2025-12-25', shipperAddr: 'Yaowarat', receiverAddr: 'Liverpool', originLat: 13.7400, originLng: 100.5100, destLat: 53.4084, destLng: -2.9916 },
            { hwb: '6677889900', origin: 'TH', dest: 'FR', weight: 4.5, desc: 'SNACKS', shipperCity: 'PHUKET', shipper: 'ANDAMAN GOODS', receiver: 'PIERRE DUBOIS', date: '2025-12-28', shipperAddr: 'Patong', receiverAddr: 'Paris', originLat: 7.8900, originLng: 98.2900, destLat: 48.8566, destLng: 2.3522 },
            // Jan
            { hwb: '30001', origin: 'TH', dest: 'GB', weight: 2.5, desc: 'SNACK', shipperCity: 'BANGKOK', shipper: 'SOMSREE STORE', receiver: 'DAVID JONES', date: '2026-01-05', shipperAddr: 'Bangkok', receiverAddr: 'Manchester', originLat: 13.7500, originLng: 100.5000, destLat: 53.4808, destLng: -2.2426 },
            { hwb: '30002', origin: 'TH', dest: 'DE', weight: 1.5, desc: 'TEA', shipperCity: 'CHONBURI', shipper: 'PATTAYA EXPORT', receiver: 'KLAUS WEBER', date: '2026-01-10', shipperAddr: 'Pattaya', receiverAddr: 'Hamburg', originLat: 12.9200, originLng: 100.8800, destLat: 53.5511, destLng: 9.9937 },
            { hwb: '30003', origin: 'TH', dest: 'KR', weight: 1.2, desc: 'COSMETICS', shipperCity: 'BANGKOK', shipper: 'KOREAN BEAUTY', receiver: 'SEOUL TRADING', date: '2026-01-15', shipperAddr: 'Bangkok', receiverAddr: 'Seoul', originLat: 13.7500, originLng: 100.5000, destLat: 37.5665, destLng: 126.9780 },
            { hwb: '30004', origin: 'TH', dest: 'US', weight: 4.8, desc: 'HERBS', shipperCity: 'UDON THANI', shipper: 'ISAAN HERBS', receiver: 'US ORGANICS', date: '2026-01-20', shipperAddr: 'Udon Thani', receiverAddr: 'Los Angeles', originLat: 17.4150, originLng: 102.7860, destLat: 34.0522, destLng: -118.2437 },
            { hwb: '30005', origin: 'TH', dest: 'GB', weight: 3.0, desc: 'TEA', shipperCity: 'BANGKOK', shipper: 'THAI TEA CO', receiver: 'LONDON TEA', date: '2026-01-22', shipperAddr: 'Bangkok', receiverAddr: 'London', originLat: 13.7500, originLng: 100.5000, destLat: 51.5074, destLng: -0.1278 }
        ];

        // --- Dictionaries ---
        const PROVINCE_COORDS = { 'BANGKOK': [13.7563, 100.5018], 'SAMUTPRAKARN': [13.5991, 100.5968], 'SAMUT PRAKAN': [13.5991, 100.5968], 'SURAT THANI': [9.1386, 99.3304], 'SURATTHANI': [9.1386, 99.3304], 'PATHUMTHANI': [14.0208, 100.5250], 'PATHUM THANI': [14.0208, 100.5250], 'CHIANG MAI': [18.7883, 98.9853], 'NONTHABURI': [13.8591, 100.5217], 'PHUKET': [7.8804, 98.3923], 'CHONBURI': [13.3611, 100.9847], 'UDON THANI': [17.415, 102.786] };
        const COUNTRY_COORDS = { 'GB': [54.0000, -2.0000], 'JP': [36.2048, 138.2529], 'BE': [50.5039, 4.4699], 'MU': [-20.3484, 57.5522], 'DE': [51.1657, 10.4515], 'US': [37.0902, -95.7129], 'AU': [-25.2744, 133.7751], 'FR': [46.2276, 2.2137], 'NL': [52.1326, 5.2913], 'KR': [35.9078, 127.7669] };

        // --- Icons ---
        const Icons = {
            Shield: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>,
            BarChart: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z" /><path strokeLinecap="round" strokeLinejoin="round" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z" /></svg>,
            Map: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" /></svg>,
            Globe: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
            FileText: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>,
            Download: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>,
            Search: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>,
            TrendingUp: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M23 6l-9.5 9.5-5-5L1 18"/><path d="M17 6h6v6"/></svg>,
            AlertTriangle: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>,
            Upload: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg>,
            Lock: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>,
            Edit: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>,
            Database: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4" /></svg>,
            Save: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" /></svg>,
            Close: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>,
            Pin: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path strokeLinecap="round" strokeLinejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>,
            MapPin: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path strokeLinecap="round" strokeLinejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>,
            Target: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>
        };

        const SectionHeader = ({ number, title }) => (
            <div className="flex items-center mt-10 mb-6 border-b border-slate-200 pb-3">
                <div className="flex items-center justify-center w-10 h-10 bg-gradient-to-br from-brand-600 to-brand-800 text-white font-bold rounded-lg shadow-soft mr-4 text-xl">{number}</div>
                <h2 className="text-xl font-bold text-slate-800 uppercase tracking-tight">{title}</h2>
            </div>
        );

        const InfographicBanner = () => (
            <div className="w-full bg-gradient-to-r from-brand-900 to-brand-700 rounded-2xl shadow-lg p-6 mb-8 text-white relative overflow-hidden">
                <div className="absolute top-0 right-0 opacity-10 transform translate-x-10 -translate-y-10"><Icons.Shield /></div>
                <div className="flex flex-col md:flex-row items-center justify-between z-10 relative">
                    <div className="mb-4 md:mb-0">
                        <h2 className="text-2xl font-bold mb-2">Cannabis Interdiction Intelligence</h2>
                        <p className="text-brand-100 text-sm max-w-xl">
                            รายงานวิเคราะห์สถานการณ์การลักลอบส่งออกช่อดอกกัญชาผ่านระบบขนส่งเอกชน (Private Courier) 
                            เพื่อสนับสนุนการปฏิบัติงานของเจ้าหน้าที่ในการสกัดกั้นและปราบปรามยาเสพติด
                        </p>
                    </div>
                    <div className="flex space-x-4">
                        <div className="text-center p-3 bg-white/10 rounded-lg backdrop-blur-sm">
                            <div className="text-2xl font-bold text-accent-amber">Monitor</div>
                            <div className="text-xs text-white/70 uppercase">Tracking</div>
                        </div>
                        <div className="text-center p-3 bg-white/10 rounded-lg backdrop-blur-sm">
                            <div className="text-2xl font-bold text-accent-rose">Detect</div>
                            <div className="text-xs text-white/70 uppercase">Seizures</div>
                        </div>
                        <div className="text-center p-3 bg-white/10 rounded-lg backdrop-blur-sm">
                            <div className="text-2xl font-bold text-accent-teal">Analyze</div>
                            <div className="text-xs text-white/70 uppercase">Data</div>
                        </div>
                    </div>
                </div>
            </div>
        );

        const NavButton = ({ label, active, onClick, icon }) => {
            const activeClass = "bg-white text-brand-700 border-brand-200 shadow-sm font-bold ring-1 ring-brand-100";
            const inactiveClass = "text-brand-100 hover:bg-brand-800 hover:text-white border-transparent";
            return (
                <button onClick={onClick} className={`flex items-center px-4 py-2.5 rounded-lg transition-all duration-200 text-sm border ${active ? activeClass : inactiveClass}`}>
                    <span className="mr-2.5">{icon}</span>{label}
                </button>
            );
        };

        const KPICard = ({ title, value, unit, icon, color }) => {
            const themes = {
                brand: { border: 'border-brand-500', text: 'text-brand-700', iconBg: 'bg-brand-50', iconColor: 'text-brand-600' },
                accent1: { border: 'border-accent-teal', text: 'text-teal-700', iconBg: 'bg-teal-50', iconColor: 'text-teal-600' },
                accent2: { border: 'border-accent-rose', text: 'text-rose-700', iconBg: 'bg-rose-50', iconColor: 'text-rose-600' },
                accent3: { border: 'border-accent-amber', text: 'text-amber-700', iconBg: 'bg-amber-50', iconColor: 'text-amber-600' },
            };
            const t = themes[color] || themes.brand;
            return (
                <div className={`bg-white p-6 rounded-xl shadow-soft border-l-4 ${t.border} flex flex-col justify-between hover:shadow-card transition-all`}>
                    <div className="flex justify-between items-start mb-3">
                        <div>
                            <p className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">{title}</p>
                            <h3 className={`text-3xl font-extrabold ${t.text}`}>{value}</h3>
                        </div>
                        <div className={`p-3 rounded-xl ${t.iconBg} ${t.iconColor} shadow-sm`}>{icon}</div>
                    </div>
                    <p className="text-xs font-medium text-slate-400">{unit}</p>
                </div>
            );
        };

        const getWeight = (row) => {
            if (row['Weight'] && !isNaN(parseFloat(row['Weight']))) return parseFloat(row['Weight']);
            if (row['Shp Weight'] && !isNaN(parseFloat(row['Shp Weight']))) return parseFloat(row['Shp Weight']);
            if (row['Piece Weight'] && !isNaN(parseFloat(row['Piece Weight']))) return parseFloat(row['Piece Weight']);
            const values = Object.values(row);
            if (values.length > 7) { const val = parseFloat(values[7]); if (!isNaN(val)) return val; }
            return 0;
        };

        const openGoogleMaps = (lat, lng, query) => {
            let url = 'https://www.google.com/maps/search/?api=1&query=';
            if (lat && lng) url += `${lat},${lng}`;
            else if (query) url += encodeURIComponent(query);
            else return;
            window.open(url, '_blank');
        };

        const CaseDataTable = ({ data, onEdit }) => {
            const [search, setSearch] = useState('');
            const [originCitySearch, setOriginCitySearch] = useState('');
            const [destCitySearch, setDestCitySearch] = useState('');

            const filteredData = (data || []).filter(item => {
                const s = (search || '').toLowerCase();
                const globalMatch = 
                    (item.hwb || '').toLowerCase().includes(s) || 
                    (item.shipper || '').toLowerCase().includes(s) || 
                    (item.receiver || '').toLowerCase().includes(s);
                const originMatch = (item.shipperCity || '').toLowerCase().includes((originCitySearch || '').toLowerCase());
                const destMatch = (item.receiverCity || '').toLowerCase().includes((destCitySearch || '').toLowerCase());
                return globalMatch && originMatch && destMatch;
            });

            return (
                <div className="bg-white rounded-xl shadow-soft border border-slate-200 overflow-hidden">
                    <div className="p-5 border-b border-slate-200 bg-slate-50">
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div className="relative">
                                <span className="absolute inset-y-0 left-0 pl-3 flex items-center text-slate-400"><Icons.Search/></span>
                                <input type="text" placeholder="ค้นหา HWB, ผู้ส่ง, ผู้รับ..." className="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-brand-500 outline-none transition" value={search} onChange={e => setSearch(e.target.value)} />
                            </div>
                            <input type="text" placeholder="กรองเมืองต้นทาง..." className="w-full px-4 py-2 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-brand-500 outline-none transition" value={originCitySearch} onChange={e => setOriginCitySearch(e.target.value)} />
                            <input type="text" placeholder="กรองเมืองปลายทาง..." className="w-full px-4 py-2 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-brand-500 outline-none transition" value={destCitySearch} onChange={e => setDestCitySearch(e.target.value)} />
                        </div>
                    </div>
                    <div className="overflow-x-auto">
                        <table className="w-full text-left">
                            <thead>
                                <tr>
                                    <th className="custom-table th w-16 text-center">แก้ไข</th>
                                    <th className="custom-table th">HWB / วันที่</th>
                                    <th className="custom-table th">ผู้ส่ง (Shipper)</th>
                                    <th className="custom-table th">ผู้รับ (Receiver)</th>
                                    <th className="custom-table th text-right">น้ำหนัก (Kg)</th>
                                    <th className="custom-table th text-center">ตำแหน่ง (Location)</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-slate-100">
                                {filteredData.map((row, idx) => (
                                    <tr key={idx} className="hover:bg-slate-50 transition-colors">
                                        <td className="custom-table td text-center">
                                            <button onClick={() => onEdit(data.indexOf(row))} className="text-slate-400 hover:text-brand-600 transition"><Icons.Edit /></button>
                                        </td>
                                        <td className="custom-table td">
                                            <div className="font-mono font-medium text-brand-700">{row.hwb}</div>
                                            <div className="text-xs text-slate-400 mt-0.5">{row.date ? row.date.split(' ')[0] : '-'}</div>
                                        </td>
                                        <td className="custom-table td">
                                            <div className="font-medium text-slate-700">{row.shipper}</div>
                                            <div className="text-xs text-slate-500 mt-0.5">{row.shipperCity}</div>
                                        </td>
                                        <td className="custom-table td">
                                            <div className="font-medium text-slate-700">{row.receiver}</div>
                                            <div className="text-xs text-slate-500 mt-0.5">{row.receiverCity} ({row.dest})</div>
                                        </td>
                                        <td className="custom-table td text-right font-bold text-accent-rose">
                                            {parseFloat(row.weight || 0).toFixed(2)}
                                        </td>
                                        <td className="custom-table td text-center">
                                            <div className="flex justify-center gap-2">
                                                <button onClick={() => openGoogleMaps(row.originLat, row.originLng, row.shipperAddr || row.shipperCity)} className="flex items-center px-2 py-1 bg-red-50 text-red-600 rounded text-xs font-bold hover:bg-red-100 transition border border-red-100" title="Origin GPS">
                                                    <span className="mr-1"><Icons.Pin/></span> ต้นทาง
                                                </button>
                                                <button onClick={() => openGoogleMaps(row.destLat, row.destLng, row.receiverAddr || row.receiverCity)} className="flex items-center px-2 py-1 bg-blue-50 text-blue-600 rounded text-xs font-bold hover:bg-blue-100 transition border border-blue-100" title="Dest GPS">
                                                    <span className="mr-1"><Icons.Target/></span> ปลายทาง
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                ))}
                                {filteredData.length === 0 && <tr><td colSpan="6" className="px-6 py-12 text-center text-slate-400 italic">ไม่พบข้อมูลที่ค้นหา</td></tr>}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        const EditModal = ({ item, onSave, onClose }) => {
            const [formData, setFormData] = useState({ ...item });
            const handleChange = (e) => setFormData({ ...formData, [e.target.name]: e.target.value });
            return (
                <div className="fixed inset-0 bg-slate-900/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4">
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden animate-fade-in">
                        <div className="bg-white px-6 py-4 border-b border-slate-100 flex justify-between items-center">
                            <h3 className="font-bold text-lg text-slate-800 flex items-center"><span className="mr-2 text-brand-600"><Icons.Edit/></span> แก้ไขข้อมูล (Edit Data)</h3>
                            <button onClick={onClose} className="text-slate-400 hover:text-slate-600 transition"><Icons.Close /></button>
                        </div>
                        <div className="p-6 grid grid-cols-2 gap-5 max-h-[70vh] overflow-y-auto bg-slate-50/50">
                            <div><label className="text-xs font-bold text-slate-500 uppercase block mb-1">HWB No</label><input type="text" value={formData.hwb} className="w-full p-2 bg-slate-100 border border-slate-200 rounded text-slate-500 text-sm cursor-not-allowed" readOnly /></div>
                            <div><label className="text-xs font-bold text-slate-500 uppercase block mb-1">Date</label><input type="text" name="date" value={formData.date} onChange={handleChange} className="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:border-brand-500 outline-none" /></div>
                            
                            <div className="col-span-2 pt-2 border-t border-slate-200"><span className="text-xs font-bold text-brand-600 uppercase tracking-wider">ข้อมูลผู้ส่ง (Shipper)</span></div>
                            <div><label className="text-xs text-slate-500 block mb-1">Name</label><input type="text" name="shipper" value={formData.shipper} onChange={handleChange} className="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:border-brand-500 outline-none" /></div>
                            <div><label className="text-xs text-slate-500 block mb-1">City</label><input type="text" name="shipperCity" value={formData.shipperCity} onChange={handleChange} className="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:border-brand-500 outline-none" /></div>
                            <div className="col-span-2"><label className="text-xs text-slate-500 block mb-1">Address</label><input type="text" name="shipperAddr" value={formData.shipperAddr} onChange={handleChange} className="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:border-brand-500 outline-none" /></div>

                            <div className="col-span-2 pt-2 border-t border-slate-200"><span className="text-xs font-bold text-brand-600 uppercase tracking-wider">ข้อมูลผู้รับ (Receiver)</span></div>
                            <div><label className="text-xs text-slate-500 block mb-1">Name</label><input type="text" name="receiver" value={formData.receiver} onChange={handleChange} className="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:border-brand-500 outline-none" /></div>
                            <div><label className="text-xs text-slate-500 block mb-1">City / Country</label><input type="text" name="dest" value={formData.dest} onChange={handleChange} className="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:border-brand-500 outline-none" /></div>
                            <div className="col-span-2"><label className="text-xs text-slate-500 block mb-1">Address</label><input type="text" name="receiverAddr" value={formData.receiverAddr} onChange={handleChange} className="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:border-brand-500 outline-none" /></div>

                            <div className="col-span-2 pt-2 border-t border-slate-200"><span className="text-xs font-bold text-accent-rose uppercase tracking-wider">รายละเอียดสินค้า (Cargo)</span></div>
                            <div><label className="text-xs text-slate-500 block mb-1">Description</label><input type="text" name="desc" value={formData.desc} onChange={handleChange} className="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:border-brand-500 outline-none" /></div>
                            <div><label className="text-xs font-bold text-accent-rose block mb-1">Weight (Kg)</label><input type="number" step="0.01" name="weight" value={formData.weight} onChange={handleChange} className="w-full p-2 bg-white border border-accent-rose text-accent-rose font-bold rounded text-sm focus:border-accent-rose outline-none" /></div>
                        </div>
                        <div className="bg-white px-6 py-4 flex justify-end gap-3 border-t border-slate-100">
                            <button onClick={onClose} className="px-4 py-2 text-sm font-medium text-slate-500 hover:text-slate-700 hover:bg-slate-50 rounded-lg transition">ยกเลิก (Cancel)</button>
                            <button onClick={() => onSave(formData)} className="px-6 py-2 text-sm font-bold text-white bg-brand-600 hover:bg-brand-700 rounded-lg shadow-soft transition">บันทึก (Save)</button>
                        </div>
                    </div>
                </div>
            );
        };

        const ReportTable = ({ data, type }) => (
            <div className="overflow-x-auto rounded-xl shadow-card border border-slate-200 bg-white">
                <table className="w-full text-left">
                    <thead>
                        <tr>
                            <th className="custom-table th">วันที่ (Date)</th>
                            <th className="custom-table th">{type === 'dest' ? 'ผู้รับ (Receiver)' : 'ผู้ส่ง (Shipper)'}</th>
                            <th className="custom-table th">ที่อยู่ (Address)</th>
                            <th className="custom-table th">{type === 'origin' ? 'ปลายทาง (Dest)' : 'ต้นทาง (Origin)'}</th>
                            <th className="custom-table th text-right">น้ำหนัก (Kg)</th>
                            <th className="custom-table th text-center">พิกัด (Map)</th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-slate-100">
                        {(data || []).map((row, idx) => (
                            <tr key={idx} className="hover:bg-slate-50 transition-colors">
                                <td className="custom-table td text-slate-500">{row.date ? row.date.split(' ')[0] : '-'}</td>
                                <td className="custom-table td font-medium text-slate-700">{type === 'dest' ? (row.receiver || 'Unknown') : (row.shipper || 'Unknown')}</td>
                                <td className="custom-table td text-xs text-slate-500 max-w-xs truncate" title={type === 'dest' ? row.receiverAddr : row.shipperAddr}>{type === 'dest' ? (row.receiverAddr || 'N/A') : (row.shipperAddr || 'N/A')}</td>
                                <td className="custom-table td"><span className={`px-2 py-1 text-xs font-bold rounded ${type==='origin'?'bg-indigo-50 text-indigo-700':'bg-emerald-50 text-emerald-700'}`}>{type==='origin' ? row.dest : row.shipperCity}</span></td>
                                <td className="custom-table td text-right font-bold text-accent-rose">{parseFloat(row.weight || 0).toFixed(2)}</td>
                                <td className="custom-table td text-center">
                                    <button 
                                        onClick={() => openGoogleMaps(type === 'dest' ? row.destLat : row.originLat, type === 'dest' ? row.destLng : row.originLng, type === 'dest' ? (row.receiverAddr || row.receiverCity) : (row.shipperAddr || row.shipperCity))}
                                        className="text-xs font-bold text-brand-600 hover:text-brand-800 bg-brand-50 hover:bg-brand-100 px-3 py-1 rounded-full transition flex items-center justify-center mx-auto"
                                    >
                                        <span className="mr-1"><Icons.MapPin/></span> ดูพิกัด
                                    </button>
                                </td>
                            </tr>
                        ))}
                        {(!data || data.length === 0) && <tr><td colSpan="6" className="px-6 py-12 text-center text-slate-400 italic">ไม่พบข้อมูล</td></tr>}
                    </tbody>
                </table>
            </div>
        );

        const LeafletMap = ({ center, zoom, markers, color }) => {
            const mapRef = useRef(null);
            const mapInstanceRef = useRef(null);
            const markersLayerRef = useRef(null);

            useEffect(() => {
                if (mapRef.current && !mapInstanceRef.current) {
                    mapInstanceRef.current = L.map(mapRef.current).setView(center, zoom);
                    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', { 
                        attribution: '&copy; OpenStreetMap & CartoDB',
                        maxZoom: 19 
                    }).addTo(mapInstanceRef.current);
                    markersLayerRef.current = L.layerGroup().addTo(mapInstanceRef.current);
                }
                if (mapInstanceRef.current && markersLayerRef.current) {
                    markersLayerRef.current.clearLayers();
                    markers.forEach(m => {
                        // Bubble Map Logic
                        const baseRadius = 6;
                        const factor = 2.5;
                        const maxRadius = 50;
                        const radius = Math.min(baseRadius + (m.count * factor), maxRadius);

                        const fillColor = color === 'red' ? '#f43f5e' : '#f59e0b';
                        const strokeColor = color === 'red' ? '#be123c' : '#b45309';

                        const circle = L.circleMarker(m.latlng, {
                            color: strokeColor,
                            fillColor: fillColor,
                            fillOpacity: 0.6,
                            radius: radius,
                            weight: 1.5
                        });
                        const popup = `
                            <div style="font-family:Sarabun, sans-serif; color:#1e293b; padding:4px;">
                                <div style="font-weight:700; font-size:1.1em; margin-bottom:4px;">${m.name}</div>
                                <div style="font-size:0.9em; color:#475569;">Total Cases: <span style="font-weight:600; color:#0f172a;">${m.count}</span></div>
                                <div style="font-size:0.9em; color:#475569;">Total Weight: <span style="font-weight:600; color:#0f172a;">${parseFloat(m.weight).toFixed(2)} Kg</span></div>
                            </div>`;
                        circle.bindPopup(popup);
                        circle.bindTooltip(`${m.name}`, {direction:'top', offset:[0,-radius], opacity:0.9, className: 'font-sans'});
                        markersLayerRef.current.addLayer(circle);
                    });
                }
            }, [markers, center, zoom]);
            return <div ref={mapRef} className="h-full w-full" style={{ minHeight: '500px' }} />;
        };

        const App = () => {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [data, setData] = useState(MOCK_SHIPMENTS);
            const [fileStatus, setFileStatus] = useState({ loaded: false });
            const [selectedProvince, setSelectedProvince] = useState('ALL');
            const [selectedCountry, setSelectedCountry] = useState('ALL');
            const [editingIndex, setEditingIndex] = useState(null);
            const contentRef = useRef(null);

            const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, PieChart, Pie, Cell } = window.Recharts || {};

            const stats = useMemo(() => {
                const totalShipments = (data || []).length;
                const totalWeight = (data || []).reduce((acc, curr) => acc + parseFloat(curr.weight || 0), 0);
                const groupBy = (keyFn) => (data || []).reduce((acc, curr) => { const k = keyFn(curr); if (!acc[k]) acc[k] = { name: k, count: 0, weight: 0 }; acc[k].count += 1; acc[k].weight += parseFloat(curr.weight || 0); return acc; }, {});
                
                // 1. Monthly (Oct - Jan)
                const monthMap = { '2025-10': 'ต.ค. 68', '2025-11': 'พ.ย. 68', '2025-12': 'ธ.ค. 68', '2026-01': 'ม.ค. 69' };
                const byMonthObj = groupBy(curr => curr.date ? curr.date.substring(0, 7) : 'Unknown');
                const orderedMonths = ['2025-10', '2025-11', '2025-12', '2026-01'];
                const chartData = orderedMonths.map(key => ({
                    name: monthMap[key] || key,
                    weight: byMonthObj[key] ? byMonthObj[key].weight : 0,
                    count: byMonthObj[key] ? byMonthObj[key].count : 0
                }));
                
                // 2. Top 10 Dest
                const byCountryObj = groupBy(curr => curr.dest || 'Unknown');
                const topDestData = Object.values(byCountryObj).sort((a,b) => b.count - a.count).slice(0, 10);
                
                // 3. Top 10 Origin
                const byProvinceObj = groupBy(curr => { let c = (curr.shipperCity || 'Unknown').toUpperCase().trim(); if(c.includes('BANGKOK')) c='BANGKOK'; if(c.includes('SAMUT')) c='SAMUTPRAKARN'; return c; });
                const topOriginData = Object.values(byProvinceObj).sort((a,b) => b.count - a.count).slice(0, 10);
                
                // Bubble Map Data (Aggregated)
                const provinceMapData = Object.values(byProvinceObj).map(p => ({ ...p, latlng: PROVINCE_COORDS[p.name] })).filter(p => p.latlng);
                const countryMapData = Object.values(byCountryObj).map(c => ({ ...c, latlng: COUNTRY_COORDS[c.name] })).filter(c => c.latlng);
                
                const byTypeObj = groupBy(curr => { const desc = (curr.desc || '').toLowerCase(); if (desc.includes('tea')||desc.includes('food')) return 'Tea/Food'; if (desc.includes('cosmetic')||desc.includes('cream')) return 'Cosmetics'; if (desc.includes('toy')||desc.includes('gift')) return 'Toys/Gifts'; return 'Others'; });
                const byTypeData = Object.keys(byTypeObj).map(k => ({ name: k, value: byTypeObj[k].count }));

                return { totalShipments, totalWeight: totalWeight.toFixed(2), chartData, topDestData, topOriginData, provinceMapData, countryMapData, byTypeData, provincesList: ['ALL', ...Object.keys(byProvinceObj).sort()], countriesList: ['ALL', ...Object.keys(byCountryObj).sort()], topCountryCode: topDestData[0]?.name || '-' };
            }, [data]);

            const originReportData = useMemo(() => {
                const filtered = selectedProvince === 'ALL' ? data : (data || []).filter(d => { let c = (d.shipperCity||'').toUpperCase(); if(c.includes('BANGKOK')) c='BANGKOK'; if(c.includes('SAMUT')) c='SAMUTPRAKARN'; return c === selectedProvince; });
                return { data: filtered, count: filtered.length, weight: filtered.reduce((acc, c) => acc + parseFloat(c.weight||0), 0).toFixed(2) };
            }, [data, selectedProvince]);

            const destReportData = useMemo(() => {
                const filtered = selectedCountry === 'ALL' ? data : (data || []).filter(d => d.dest === selectedCountry);
                return { data: filtered, count: filtered.length, weight: filtered.reduce((acc, c) => acc + parseFloat(c.weight||0), 0).toFixed(2) };
            }, [data, selectedCountry]);

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    Papa.parse(file, {
                        header: true, skipEmptyLines: true,
                        complete: (results) => {
                            const newDocs = (results.data || []).map(row => ({
                                hwb: row['HWB No'], origin: row['Orig Ctry']||'TH', dest: row['Dest Ctry'],
                                weight: getWeight(row), desc: row['Description'],
                                shipperCity: row['Shpr City']||row['Shpr Province']||'Unknown',
                                shipper: row['Shipper Name']||row['Shipper']||'Unknown',
                                shipperAddr: [row['Shpr Addr 1'], row['Shpr Addr 2'], row['Shpr City']].filter(Boolean).join(', '),
                                receiver: row['Receiver Name']||'Unknown',
                                receiverCity: row['Rcvr City']||'Unknown',
                                receiverAddr: [row['Rcvr Addr 1'], row['Rcvr Addr 2'], row['Rcvr City']].filter(Boolean).join(', '),
                                date: row['EDD']||'2025-12-01'
                            })).filter(r => r.hwb);
                            setData(newDocs); setFileStatus({ loaded: true });
                        }
                    });
                }
            };

            const exportToPDF = () => {
                const element = contentRef.current; if (!element) return;
                element.classList.add('print-area');
                html2canvas(element, { useCORS: true, scale: 2 }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png'); const pdf = new jsPDF('p', 'mm', 'a4');
                    const imgWidth = 190; const pageHeight = 295; const imgHeight = canvas.height * imgWidth / canvas.width;
                    let heightLeft = imgHeight; let position = 10;
                    pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight); heightLeft -= pageHeight;
                    while (heightLeft >= 0) { position = heightLeft - imgHeight; pdf.addPage(); pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight); heightLeft -= pageHeight; }
                    pdf.save(`CIU_Report.pdf`); element.classList.remove('print-area');
                });
            };

            if (!isLoggedIn) return (
                <div className="min-h-screen flex items-center justify-center bg-slate-50 relative">
                    <div className="bg-white p-10 rounded-2xl shadow-2xl w-96 border border-slate-200 z-10">
                        <div className="flex flex-col items-center mb-8">
                            <div className="p-4 bg-brand-50 text-brand-600 rounded-full mb-4 shadow-sm"><Icons.Shield /></div>
                            <h2 className="text-2xl font-extrabold text-slate-800 text-center">Secure Access</h2>
                            <p className="text-xs text-slate-400 mt-2 uppercase tracking-widest">Cannabis Smuggling Data System</p>
                        </div>
                        <form onSubmit={(e) => { e.preventDefault(); const p = e.target.password.value; if(p==='24689') setIsLoggedIn(true); else alert('Access Denied'); }} className="space-y-6">
                            <div className="relative"><span className="absolute inset-y-0 left-0 pl-3 flex items-center text-slate-400"><Icons.Lock/></span><input type="password" name="password" className="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-brand-500 outline-none transition" placeholder="Enter PIN Code" /></div>
                            <button className="w-full bg-gradient-to-r from-brand-600 to-brand-700 hover:from-brand-700 hover:to-brand-800 text-white font-bold py-3 rounded-lg shadow-lg hover:shadow-brand-500/30 transition-all transform hover:-translate-y-0.5">Authenticate</button>
                        </form>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen flex flex-col bg-slate-50 font-sans">
                    {editingIndex !== null && <EditModal item={data[editingIndex]} onSave={(updated) => { const newData = [...data]; newData[editingIndex] = updated; setData(newData); setEditingIndex(null); }} onClose={() => setEditingIndex(null)} />}
                    
                    <header className="header-gradient text-white sticky top-0 z-50 shadow-lg">
                        <div className="container mx-auto px-6 py-4">
                            <div className="flex flex-col lg:flex-row justify-between items-center mb-4">
                                <div className="flex items-center gap-4 mb-4 lg:mb-0">
                                    <div className="p-2.5 bg-white/10 rounded-xl backdrop-blur-sm border border-white/10 shadow-sm"><Icons.Shield /></div>
                                    <div>
                                        <h1 className="text-xl font-bold leading-tight tracking-tight text-white">ระบบข้อมูลการลักลอบส่งออกช่อดอกกัญชา <span className="opacity-90 font-semibold text-lg block mt-0.5">จากจังหวัดสมุทรปราการ ผ่าน ขนส่งเอกชน</span></h1>
                                        <p className="text-xs text-white/80 mt-1 font-medium">พัฒนาโดย ภก.จีรภัทร พลายงาม | <span className="font-bold text-brand-100">Version Beta (27 ม.ค. 2026)</span></p>
                                    </div>
                                </div>
                                <div className="flex gap-3">
                                    <button onClick={exportToPDF} className="flex items-center px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-sm font-semibold backdrop-blur-sm border border-white/10 transition"><span className="mr-2"><Icons.Download/></span> Export Report</button>
                                    <button onClick={() => setIsLoggedIn(false)} className="px-4 py-2 bg-danger-600 hover:bg-danger-700 rounded-lg text-sm font-semibold shadow-sm transition">Logout</button>
                                </div>
                            </div>
                            <nav className="flex flex-wrap gap-2">
                                <NavButton label="1. ภาพรวม (Overview)" active={activeTab === 'dashboard'} onClick={() => setActiveTab('dashboard')} icon={<Icons.BarChart />} />
                                <NavButton label="2. จัดการข้อมูลรายเคส (Case Data)" active={activeTab === 'case_data'} onClick={() => setActiveTab('case_data')} icon={<Icons.Database />} />
                                <NavButton label="3. รายงานต้นทาง (Origin Intel)" active={activeTab === 'origin_report'} onClick={() => setActiveTab('origin_report')} icon={<Icons.FileText />} />
                                <NavButton label="4. แผนที่ต้นทาง (Origin Map)" active={activeTab === 'origin'} onClick={() => setActiveTab('origin')} icon={<Icons.Map />} />
                                <NavButton label="5. รายงานปลายทาง (Dest Intel)" active={activeTab === 'dest_report'} onClick={() => setActiveTab('dest_report')} icon={<Icons.Globe />} />
                                <NavButton label="6. แผนที่ปลายทาง (Dest Map)" active={activeTab === 'dest'} onClick={() => setActiveTab('dest')} icon={<Icons.Map />} />
                            </nav>
                        </div>
                    </header>
                    <main className="container mx-auto p-8 flex-1" ref={contentRef}>
                        {!fileStatus.loaded && <div className="mb-8 p-4 bg-white border border-slate-200 rounded-xl shadow-sm flex justify-between items-center"><div className="flex items-center text-slate-600 text-sm"><span className="text-accent-amber mr-2"><Icons.AlertTriangle /></span> <span className="font-medium">System is running with sample data. Upload CSV for real-time analysis.</span></div><label className="cursor-pointer px-5 py-2.5 bg-slate-900 text-white text-xs font-bold uppercase rounded-lg hover:bg-slate-800 transition flex items-center shadow-sm"><Icons.Upload /><span className="ml-2">Upload Data</span><input type="file" accept=".csv" className="hidden" onChange={handleFileUpload} /></label></div>}
                        
                        {activeTab === 'dashboard' && window.Recharts && (
                            <div className="space-y-10 animate-fade-in">
                                <InfographicBanner />
                                <SectionHeader number="01" title="Key Performance Indicators (ตัวชี้วัดสำคัญ)" />
                                <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                                    <KPICard title="Total Seizures" value={stats.totalShipments} unit="Cases Detected" icon={<Icons.Search />} color="brand" />
                                    <KPICard title="Total Weight" value={stats.totalWeight} unit="Kilograms (Kg)" icon={<Icons.TrendingUp />} color="accent1" />
                                    <KPICard title="High Risk Dest" value={stats.topCountryCode} unit="Country Code" icon={<Icons.AlertTriangle />} color="accent2" />
                                    <KPICard title="Top Concealment" value="Tea / Food" unit="Declared Item" icon={<Icons.FileText />} color="accent3" />
                                </div>
                                <SectionHeader number="02" title="Analysis: Weight & Trends" />
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                    <div className="bg-white p-6 rounded-xl shadow-card border border-slate-200">
                                        <h3 className="text-sm font-bold text-slate-800 mb-6 uppercase tracking-wider pl-3 border-l-4 border-brand-500">Monthly Seized Weight (Kg)</h3>
                                        <div className="h-80"><ResponsiveContainer width="100%" height="100%"><BarChart data={stats.chartData}><CartesianGrid strokeDasharray="3 3" stroke="#f1f5f9" vertical={false} /><XAxis dataKey="name" stroke="#94a3b8" fontSize={12} axisLine={false} tickLine={false} /><YAxis stroke="#94a3b8" fontSize={12} axisLine={false} tickLine={false} /><Tooltip cursor={{fill: '#f8fafc'}} contentStyle={{backgroundColor:'#fff', border:'1px solid #e2e8f0', borderRadius:'8px', boxShadow:'0 4px 6px -1px rgba(0,0,0,0.1)'}} /><Bar dataKey="weight" fill="#4f46e5" radius={[4,4,0,0]} name="Weight (Kg)" barSize={40} /></BarChart></ResponsiveContainer></div>
                                    </div>
                                    <div className="bg-white p-6 rounded-xl shadow-card border border-slate-200">
                                        <h3 className="text-sm font-bold text-slate-800 mb-6 uppercase tracking-wider pl-3 border-l-4 border-accent-teal">Concealment Methods</h3>
                                        <div className="h-80"><ResponsiveContainer width="100%" height="100%"><PieChart><Pie data={stats.byTypeData} cx="50%" cy="50%" innerRadius={70} outerRadius={90} paddingAngle={2} dataKey="value">{stats.byTypeData.map((e,i)=><Cell key={i} fill={['#6366f1','#10b981','#f59e0b','#ef4444'][i%4]} strokeWidth={0}/>)}</Pie><Tooltip contentStyle={{backgroundColor:'#fff', border:'1px solid #e2e8f0', borderRadius:'8px', boxShadow:'0 4px 6px -1px rgba(0,0,0,0.1)'}} /><Legend verticalAlign="bottom" height={36}/></PieChart></ResponsiveContainer></div>
                                    </div>
                                </div>
                                <SectionHeader number="03" title="Risk Rankings (Top 10)" />
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                    <div className="bg-white p-6 rounded-xl shadow-card border border-slate-200"><h3 className="text-sm font-bold text-slate-800 mb-4 uppercase tracking-wider pl-3 border-l-4 border-accent-amber">Top 10 Destinations</h3><div className="h-96"><ResponsiveContainer><BarChart data={stats.topDestData} layout="vertical"><CartesianGrid strokeDasharray="3 3" stroke="#f1f5f9" horizontal={true} vertical={false} /><XAxis type="number" stroke="#94a3b8" fontSize={11} axisLine={false} tickLine={false} /><YAxis dataKey="name" type="category" width={40} stroke="#64748b" fontSize={12} axisLine={false} tickLine={false} /><Tooltip cursor={{fill: '#f8fafc'}} contentStyle={{backgroundColor:'#fff', border:'1px solid #e2e8f0', borderRadius:'8px'}} /><Bar dataKey="count" fill="#8b5cf6" radius={[0,4,4,0]} barSize={20} /></BarChart></ResponsiveContainer></div></div>
                                    <div className="bg-white p-6 rounded-xl shadow-card border border-slate-200"><h3 className="text-sm font-bold text-slate-800 mb-4 uppercase tracking-wider pl-3 border-l-4 border-accent-rose">Top 10 Origins</h3><div className="h-96"><ResponsiveContainer><BarChart data={stats.topOriginData} layout="vertical"><CartesianGrid strokeDasharray="3 3" stroke="#f1f5f9" horizontal={true} vertical={false} /><XAxis type="number" stroke="#94a3b8" fontSize={11} axisLine={false} tickLine={false} /><YAxis dataKey="name" type="category" width={80} stroke="#64748b" fontSize={11} axisLine={false} tickLine={false} /><Tooltip cursor={{fill: '#f8fafc'}} contentStyle={{backgroundColor:'#fff', border:'1px solid #e2e8f0', borderRadius:'8px'}} /><Bar dataKey="count" fill="#f43f5e" radius={[0,4,4,0]} barSize={20} /></BarChart></ResponsiveContainer></div></div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'case_data' && (
                            <div className="space-y-6 animate-fade-in"><SectionHeader number="02" title="Case Data Management" /><CaseDataTable data={data} onEdit={setEditingIndex} /></div>
                        )}

                        {activeTab === 'origin_report' && (
                            <div className="space-y-6 animate-fade-in">
                                <SectionHeader number="03" title="Origin Intelligence" />
                                <div className="bg-white p-8 rounded-xl shadow-card border border-slate-200 mb-8">
                                    <div className="flex justify-between items-center mb-8"><h2 className="text-xl font-bold text-slate-800">Origin Summary Report</h2><div className="w-72"><select value={selectedProvince} onChange={e => setSelectedProvince(e.target.value)} className="w-full p-2.5 bg-slate-50 border border-slate-300 rounded-lg text-sm font-medium text-slate-700 focus:ring-2 focus:ring-accent-rose outline-none transition">{stats.provincesList.map(p => <option key={p} value={p}>{p}</option>)}</select></div></div>
                                    <div className="grid grid-cols-2 gap-6 mb-8"><div className="p-6 bg-rose-50 rounded-xl border border-rose-100 text-center"><h3 className="text-4xl font-extrabold text-accent-rose">{originReportData.count}</h3><p className="text-xs font-bold text-rose-400 uppercase mt-2 tracking-widest">Total Cases</p></div><div className="p-6 bg-rose-50 rounded-xl border border-rose-100 text-center"><h3 className="text-4xl font-extrabold text-accent-rose">{originReportData.weight}</h3><p className="text-xs font-bold text-rose-400 uppercase mt-2 tracking-widest">Total Weight (Kg)</p></div></div>
                                    <ReportTable data={originReportData.data} type="origin" />
                                </div>
                            </div>
                        )}

                        {activeTab === 'origin' && (
                            <div className="space-y-6 animate-fade-in"><SectionHeader number="04" title="Geospatial: Origin Clusters" /><div className="h-[75vh] bg-white rounded-xl border border-slate-200 shadow-card p-1"><LeafletMap center={[13.7563, 100.5018]} zoom={6} markers={stats.provinceMapData} color="red" /></div></div>
                        )}

                        {activeTab === 'dest_report' && (
                            <div className="space-y-6 animate-fade-in">
                                <SectionHeader number="05" title="Destination Intelligence" />
                                <div className="bg-white p-8 rounded-xl shadow-card border border-slate-200 mb-8">
                                    <div className="flex justify-between items-center mb-8"><h2 className="text-xl font-bold text-slate-800">Destination Summary Report</h2><div className="w-72"><select value={selectedCountry} onChange={e => setSelectedCountry(e.target.value)} className="w-full p-2.5 bg-slate-50 border border-slate-300 rounded-lg text-sm font-medium text-slate-700 focus:ring-2 focus:ring-brand-500 outline-none transition">{stats.countriesList.map(c => <option key={c} value={c}>{c}</option>)}</select></div></div>
                                    <div className="grid grid-cols-2 gap-6 mb-8"><div className="p-6 bg-indigo-50 rounded-xl border border-indigo-100 text-center"><h3 className="text-4xl font-extrabold text-brand-600">{destReportData.count}</h3><p className="text-xs font-bold text-brand-400 uppercase mt-2 tracking-widest">Total Cases</p></div><div className="p-6 bg-indigo-50 rounded-xl border border-indigo-100 text-center"><h3 className="text-4xl font-extrabold text-brand-600">{destReportData.weight}</h3><p className="text-xs font-bold text-brand-400 uppercase mt-2 tracking-widest">Total Weight (Kg)</p></div></div>
                                    <ReportTable data={destReportData.data} type="dest" />
                                </div>
                            </div>
                        )}

                        {activeTab === 'dest' && (
                            <div className="space-y-6 animate-fade-in"><SectionHeader number="06" title="Geospatial: Destination Clusters" /><div className="h-[75vh] bg-white rounded-xl border border-slate-200 shadow-card p-1"><LeafletMap center={[20, 0]} zoom={2} markers={stats.countryMapData} color="orange" /></div></div>
                        )}
                    </main>
                    <footer className="bg-white border-t border-slate-200 text-slate-500 text-center py-8 text-xs"><p className="font-semibold text-slate-700 mb-1">&copy; 2026 Cannabis Interdiction Unit (C.I.U.) Samut Prakan</p><p>System Developed by Pharm. Jeerapat Plaingam</p></footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>